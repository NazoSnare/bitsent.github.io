/*jshint esversion: 6 *//*
* ---------------------------------------------------------------------
*  BitBtn
* 
*  Copyright 2019 Aleksandar Dinkov
* 
*  URL: http://www.d-project.com/
* 
*  Licensed under the OPEN ONLY-BSV-SPECIFIC LICENSE (v0.3.0):
*    https://github.com/Pipe-Cash/OPEN-BLOCKCHAIN-SPECIFIC-LICENSE/releases/tag/v0.3.0
* 
* ---------------------------------------------------------------------
*/bitbtn=function(){function t(){return(new Date).valueOf()/1e3|0}function a(){var e=document.createElement("button");e.type="button",e.classList.add("bitbtn");var t=document.createElement("span");t.classList.add("status-circle"),t.role="status",e.cleanupCircle=function(){t.classList.remove("success"),t.classList.remove("error"),t.classList.remove("loading")},e.setCircleStatus=function(n){e.cleanupCircle(),t.classList.add(n)},e.showSuccessInCircle=function(){e.setCircleStatus("success")},e.showErrorInCircle=function(){e.setCircleStatus("error")},e.showLoadingInCircle=function(){e.setCircleStatus("loading")},e.appendChild(t);var n=document.createElement("span");n.classList.add("bitbtn-amount"),e.appendChild(n),e.setAmount=function(e){n.innerHTML=e},e.setAmount("Loading...");var r=document.createElement("span");return r.classList.add("bitbtn-label"),e.appendChild(r),e.setLabel=function(e){r.innerHTML=e},e.appLink="bitcoin:",e.setURI=function(t){e.appLink=t},e}function l(e,t){ensureParamsAreValid(t),e.params=t;var n=Math.round(e.params.amount*100)/100;e.setAmount(n+" "+e.params.currency.toUpperCase()),e.setLabel(e.params.label);if(e.params.bip21){var r=e.params.outputs[0],i=encodeURIComponent("BitBtn Payment");e.setURI("bitcoin:"+r.address+"?sv=&amount="+r.bsvAmount+"&label="+i)}}function c(e,t,n){var r=e.appLink;if(!r)throw new TypeError("AppLink not present.");var i=!1;window.addEventListener("pagehide",function(){i=!0},!1),window.addEventListener("blur",function(){i=!0},!1);var s=document.createElement("iframe");s.style.display="none",document.body.appendChild(s),s!==null&&(s.src=r),setTimeout(function(){i?t():n()},100)}function h(e){throw e.showLoadingInCircle(),new Error("BitBtn 'waitForPayment' cannot be implemented for BIP21 transactions!")}function p(e){var t=i!="iOS"&&i!="Android";t&&!e.params.bip21&&h(e),o.showAlternatives(e.appLink,t)}function d(e){c(e,success=function(){e.params.bip21===!0?e.showSuccessInCircle():h()},failure=function(){e.showErrorInCircle(),p(e)})}function v(e,t){n();try{var r=a();return e.appendChild(r),l(r,t),r.onclick=function(e){d(e.currentTarget)},r}catch(i){var s=t.onError||function(e){};o.showError(i),s(i)}}var n=function(){function n(){if(!document.getElementById(t)){var e=document.getElementsByTagName("head")[0],n=document.createElement("link");n.id=t,n.rel="stylesheet",n.type="text/css",n.media="all",n.href="btnStyle.css",e.appendChild(n)}}function r(){if(!document.getElementById(t)){var n=document.getElementsByTagName("head")[0],r=document.createElement("style");r.innerHTML=e,n.appendChild(r)}}var e=".bitbtn{cursor:pointer;display:inline-block;font-weight:400;text-align:center;vertical-align:middle;padding:0.5em 0.75em;font-size:1em;line-height:1.5;border-radius:1.5em;border:0.3em ridge}.bitbtn{color:#fff;background-color:#007bff;border-color:#0054ad}.bitbtn span{margin:0 0.15em}@-webkit-keyframes bitbtn-spinner{to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes bitbtn-spinner{to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-webkit-keyframes bitbtn-border-success{to{border-color:limegreen}}@keyframes bitbtn-border-success{to{border-color:limegreen}}@-webkit-keyframes bitbtn-border-error{to{border-color:pink}}@keyframes bitbtn-border-error{to{border-color:pink}}.bitbtn .status-circle{width:0.8em;height:0.8em;display:inline-block;vertical-align:text-bottom;border:0.2em solid transparent;border-color:transparent;background-color:white;border-radius:50%;-webkit-animation:none;animation:none}.bitbtn .status-circle.loading{border:0.2em solid currentColor;border-right-color:transparent;background-color:transparent;border-radius:50%;-webkit-animation:bitbtn-spinner 0.75s linear infinite;animation:bitbtn-spinner 0.75s linear infinite}.bitbtn .status-circle.success{border-color:transparent;background-color:rgb(163, 252, 30)}.bitbtn .status-circle.error{border-color:transparent;background-color:rgb(251, 145, 163)}.bitbtn .bitbtn-amount{font-size:1em;display:inline-block;background:#ffffff50;border-radius:10%;padding:0 3px}.bitbtn .small-text,.bitbtn-modal-container .small-text{font-size:0.6em}.bitbtn-modal-container{background-color:rgb(0,0,0);background-color:rgba(0,0,0,0.4);position:fixed;left:0;top:0;width:100%;height:100%;display:none;z-index:1;padding-top:100px;overflow:auto}.bitbtn-modal-container .modal-content{background-color:#fefefe;margin:auto;border:1px solid #888;width:70%}.bitbtn-modal-container .modal-header{display:block;background-color:rgba(0, 0, 0, 0.1)}.bitbtn-modal-container .modal-header button{padding:10px;background-color:rgba(0, 0, 0, 0.1);border:0 none;margin:none}.bitbtn-modal-container .modal-header:hover button:hover{background-color:rgba(0, 0, 0, 0.3)}.bitbtn-modal-container .modal-header button.selected{background-color:rgba(0, 0, 0, 0.3)}.bitbtn-modal-container .modal-content .modal-body{padding:20px}.bitbtn-modal-container .close{color:#aaaaaa;float:right;font-size:28px;font-weight:bold}.bitbtn-modal-container .close:focus,.bitbtn-modal-container .close:hover{color:#000;text-decoration:none;cursor:pointer}.bitbtn-modal-container .qr-code-img img{display:block;padding:20px;width:auto;max-width:50%;margin:1em auto;border:1px solid black}.bitbtn-modal-container .wallet-list{list-style:none;display:flex;flex-wrap:wrap}.bitbtn-modal-container .wallet-list .wallet-item{display:inline-block;border:3px ridge black;padding:1em 2em;margin:3px;text-align:center}.bitbtn-modal-container .wallet-list .wallet-item:hover{background:-moz-linear-gradient(-45deg, rgba(150,200,200,0) 0%, rgba(150,200,200,1) 65%, rgba(150,200,200,0) 67%, rgba(150,200,200,0) 100%);background:-webkit-linear-gradient(-45deg, rgba(150,200,200,0) 0%,rgba(150,200,200,1) 65%,rgba(150,200,200,0) 67%,rgba(150,200,200,0) 100%);background:linear-gradient(135deg, rgba(150,200,200,0) 0%,rgba(150,200,200,1) 65%,rgba(150,200,200,0) 67%,rgba(150,200,200,0) 100%);filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#0096c8c8', endColorstr='#0096c8c8',GradientType=1 )}.bitbtn-modal-container .wallet-list .wallet-item img{height:3em}",t="bitbtn-css";return function(t){t?n():r()}}(),r=function(){function i(e,n){if(typeof Storage=="undefined")return;localStorage.setItem(n,e),localStorage.setItem(n+"_timestamp",t())}function s(e,n){if(typeof Storage=="undefined")return null;var r=localStorage.getItem(e),i=localStorage.getItem(e+"_timestamp");if(!r||!i)return null;var s=t();return s-n>i?null:s<i?null:JSON.parse(r)}function o(){var e=s("coinGeckoPrices",600);if(e)return e;var t=new XMLHttpRequest;t.open("GET",r,!1),t.send(null);if(t.readyState==4&&t.status==200){var n=t.responseText;return i(n,"coinGeckoPrices"),e=JSON.parse(n),e}throw new Error(t.statusText)}function u(t){t=t.toLowerCase().trim();if(!e.includes(t))throw new Error("Unknown currency: "+t);var r=o();return t.toLowerCase()=="bsv"?1:r[n][t]}var e=["usd","aed","ars","aud","bdt","bhd","bmd","brl","cad","chf","clp","cny","czk","dkk","eur","gbp","hkd","huf","idr","ils","inr","jpy","krw","kwd","lkr","mmk","mxn","myr","nok","nzd","php","pkr","pln","rub","sar","sek","sgd","thb","try","twd","uah","vef","vnd","zar","xdr","xag","xau"],n="bitcoin-cash-sv",r="https://api.coingecko.com/api/v3/simple/price?ids="+n+"&vs_currencies="+encodeURIComponent(e.join(","));return u}(),i=function(){var e=navigator.userAgent,t=[{s:"Windows",r:/(Windows)/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/}],n="Unknown";for(var r in t){var i=t[r];if(i.r.test(e)){n=i.s;break}}return n}(),s={bitcoin:{Windows:[],Android:[],"Open BSD":[],"Sun OS":[],Linux:[],iOS:[],"Mac OS X":[],"Mac OS":[],QNX:[],UNIX:[],BeOS:[],"OS/2":[]}},o=function(){function e(e,t,n,r){var i=document.createElement(e);for(var s=0;s<t.length;s++){var o=t[s];i.classList.add(o)}for(var s=0;s<n.length;s++){var u=n[s];i.appendChild(u)}if(r){var a=document.createElement("div");a.innerHTML=r,i.append(a)}return i}function t(){var t=e("span",["close"],[],"Ã—"),n=e("nav",["modal-header"],[]),r=e("div",["modal-body"],[]),i=e("div",["bitbtn-modal-container"],[e("div",["modal-content"],[t,n,r])]);return i.openTab=function(e,t){var n=i.querySelectorAll(".modal-header button");for(var r=0;r<n.length;r++)n[r].classList.remove("selected");e.classList.add("selected");var s=i.querySelectorAll(".tab"),o=i.querySelector(".tab."+t);for(var r=0;r<s.length;r++)s[r].style.display="none";o.style.display="block"},i.clearTabs=function(){while(n.hasChildNodes())n.removeChild(n.lastChild);while(r.hasChildNodes())r.removeChild(r.lastChild)},i.addTab=function(t,s,o){var u=e("button",[],[],t);u.onclick=function(e){i.openTab(u,s)},n.appendChild(u);var a=o.slice();a.unshift(e("h2",["tab-title"],[],t));var f=e("div",["tab",s],a);r.appendChild(f)},i.clickFirstTab=function(){var e=n.querySelectorAll("button")[0];e.click()},i}function a(o,a){var f=t(),l=o.substr(0,o.indexOf(":"));if(a){var c=e("div",["qr-code-img"],[]);new u(c,o),f.addTab("QR Code","qr-code-tab",[e("p",[],[],n[l]),e("p",[],[],r[l]),e("h4",[],[],"Scan Here:"),c])}var h=s[l][i].map(function(t){var n=e("img",["wallet-item-img"],[]);n.src=t.img;var r=e("h4",["wallet-item-name"],[]);r.append(t.name);var i=e("li",["wallet-item"],[n,r]);return i.onclick=function(e){window.open(t.app,"_self")},i}),p=e("ul",["wallet-list"],h),d=s[l][i].length>0?p:e("p",[],[],"No wallets found for your Operating System"),v=e("p",[],[],"Your OS is : "+i);f.addTab("Wallets","wallets",[e("p",[],[],n[l]),v,e("p",[],[],"Here are some reccomended wallets:"),d]),f.clickFirstTab(),showModalASAP(f)}function f(n){var r=t();r.addTab("Error","errorMessage",[e("p",[],[],n)]),r.clickFirstTab(),showModalASAP(r)}showModalASAP=function l(){function t(t){t.querySelector(".modal-body").appendChild(e("p",["small-text"],[],"Timestamp : "+(new Date).toLocaleTimeString())),document.body.appendChild(t),t.style.display="block",modalCloseBtn=t.querySelector(".close"),modalCloseBtn.onclick=function(e){n(t)},window.addEventListener("click",function(e){e.target==t&&n(t)})}function n(e){try{e.parentNode.removeChild(e)}finally{modalsToShow.shift(),modalsToShow.length>0&&t(modalsToShow[0])}}function l(e){(function(){isModalShown=modalsToShow.length>0,modalsToShow.push(e),isModalShown||t(e)})()}return modalsToShow=[],l}();var n={bitcoin:"Looks like you don't have any wallet that support 'BIP21' deep linking.","bitcoin-out":"<TODO: Implement bitcoin-out>"},r={bitcoin:"You appear to be on a desktop computer. Try scanning this QR code with a BitcoinSV wallet on your smartphone.","bitcoin-out":"<TODO: Implement bitcoin-out>"};return o={showAlternatives:a,showError:f},o}(),u=function(){var e;return function(){function t(e){this.mode=l.MODE_8BIT_BYTE,this.data=e,this.parsedData=[];for(var t=0,n=this.data.length;t<n;t++){var r=[],i=this.data.charCodeAt(t);i>65536?(r[0]=240|(i&1835008)>>>18,r[1]=128|(i&258048)>>>12,r[2]=128|(i&4032)>>>6,r[3]=128|i&63):i>2048?(r[0]=224|(i&61440)>>>12,r[1]=128|(i&4032)>>>6,r[2]=128|i&63):i>128?(r[0]=192|(i&1984)>>>6,r[1]=128|i&63):r[0]=i,this.parsedData.push(r)}this.parsedData=Array.prototype.concat.apply([],this.parsedData),this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}function n(e,t){this.typeNumber=e,this.errorCorrectLevel=t,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}function r(e,t){if(e.length==undefined)throw new Error(e.length+"/"+t);var n=0;while(n<e.length&&e[n]==0)n++;this.num=new Array(e.length-n+t);for(var r=0;r<e.length-n;r++)this.num[r]=e[r+n]}function i(e,t){this.totalCount=e,this.dataCount=t}function s(){this.buffer=[],this.length=0}function o(){return typeof CanvasRenderingContext2D!="undefined"}function u(){var e=!1,t=navigator.userAgent;if(/android/i.test(t)){e=!0;var n=t.toString().match(/android ([0-9]\.[0-9])/i);n&&n[1]&&(e=parseFloat(n[1]))}return e}function a(e,t){var n=1,r=f(e);for(var i=0,s=m.length;i<=s;i++){var o=0;switch(t){case c.L:o=m[i][0];break;case c.M:o=m[i][1];break;case c.Q:o=m[i][2];break;case c.H:o=m[i][3]}if(r<=o)break;n++}if(n>m.length)throw new Error("Too long data");return n}function f(e){var t=encodeURI(e).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return t.length+(t.length!=e?3:0)}t.prototype={getLength:function(e){return this.parsedData.length},write:function(e){for(var t=0,n=this.parsedData.length;t<n;t++)e.put(this.parsedData[t],8)}},n.prototype={addData:function(e){var n=new t(e);this.dataList.push(n),this.dataCache=null},isDark:function(e,t){if(e<0||this.moduleCount<=e||t<0||this.moduleCount<=t)throw new Error(e+","+t);return this.modules[e][t]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(e,t){this.moduleCount=this.typeNumber*4+17,this.modules=new Array(this.moduleCount);for(var r=0;r<this.moduleCount;r++){this.modules[r]=new Array(this.moduleCount);for(var i=0;i<this.moduleCount;i++)this.modules[r][i]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(e,t),this.typeNumber>=7&&this.setupTypeNumber(e),this.dataCache==null&&(this.dataCache=n.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,t)},setupPositionProbePattern:function(e,t){for(var n=-1;n<=7;n++){if(e+n<=-1||this.moduleCount<=e+n)continue;for(var r=-1;r<=7;r++){if(t+r<=-1||this.moduleCount<=t+r)continue;0<=n&&n<=6&&(r==0||r==6)||0<=r&&r<=6&&(n==0||n==6)||2<=n&&n<=4&&2<=r&&r<=4?this.modules[e+n][t+r]=!0:this.modules[e+n][t+r]=!1}}},getBestMaskPattern:function(){var e=0,t=0;for(var n=0;n<8;n++){this.makeImpl(!0,n);var r=p.getLostPoint(this);if(n==0||e>r)e=r,t=n}return t},createMovieClip:function(e,t,n){var r=e.createEmptyMovieClip(t,n),i=1;this.make();for(var s=0;s<this.modules.length;s++){var o=s*i;for(var u=0;u<this.modules[s].length;u++){var a=u*i,f=this.modules[s][u];f&&(r.beginFill(0,100),r.moveTo(a,o),r.lineTo(a+i,o),r.lineTo(a+i,o+i),r.lineTo(a,o+i),r.endFill())}}return r},setupTimingPattern:function(){for(var e=8;e<this.moduleCount-8;e++){if(this.modules[e][6]!=null)continue;this.modules[e][6]=e%2==0}for(var t=8;t<this.moduleCount-8;t++){if(this.modules[6][t]!=null)continue;this.modules[6][t]=t%2==0}},setupPositionAdjustPattern:function(){var e=p.getPatternPosition(this.typeNumber);for(var t=0;t<e.length;t++)for(var n=0;n<e.length;n++){var r=e[t],i=e[n];if(this.modules[r][i]!=null)continue;for(var s=-2;s<=2;s++)for(var o=-2;o<=2;o++)s==-2||s==2||o==-2||o==2||s==0&&o==0?this.modules[r+s][i+o]=!0:this.modules[r+s][i+o]=!1}},setupTypeNumber:function(e){var t=p.getBCHTypeNumber(this.typeNumber);for(var n=0;n<18;n++){var r=!e&&(t>>n&1)==1;this.modules[Math.floor(n/3)][n%3+this.moduleCount-8-3]=r}for(var n=0;n<18;n++){var r=!e&&(t>>n&1)==1;this.modules[n%3+this.moduleCount-8-3][Math.floor(n/3)]=r}},setupTypeInfo:function(e,t){var n=this.errorCorrectLevel<<3|t,r=p.getBCHTypeInfo(n);for(var i=0;i<15;i++){var s=!e&&(r>>i&1)==1;i<6?this.modules[i][8]=s:i<8?this.modules[i+1][8]=s:this.modules[this.moduleCount-15+i][8]=s}for(var i=0;i<15;i++){var s=!e&&(r>>i&1)==1;i<8?this.modules[8][this.moduleCount-i-1]=s:i<9?this.modules[8][15-i-1+1]=s:this.modules[8][15-i-1]=s}this.modules[this.moduleCount-8][8]=!e},mapData:function(e,t){var n=-1,r=this.moduleCount-1,i=7,s=0;for(var o=this.moduleCount-1;o>0;o-=2){o==6&&o--;for(;;){for(var u=0;u<2;u++)if(this.modules[r][o-u]==null){var a=!1;s<e.length&&(a=(e[s]>>>i&1)==1);var f=p.getMask(t,r,o-u);f&&(a=!a),this.modules[r][o-u]=a,i--,i==-1&&(s++,i=7)}r+=n;if(r<0||this.moduleCount<=r){r-=n,n=-n;break}}}}},n.PAD0=236,n.PAD1=17,n.createData=function(e,t,r){var o=i.getRSBlocks(e,t),u=new s;for(var a=0;a<r.length;a++){var f=r[a];u.put(f.mode,4),u.put(f.getLength(),p.getLengthInBits(f.mode,e)),f.write(u)}var l=0;for(var a=0;a<o.length;a++)l+=o[a].dataCount;if(u.getLengthInBits()>l*8)throw new Error("code length overflow. ("+u.getLengthInBits()+">"+l*8+")");u.getLengthInBits()+4<=l*8&&u.put(0,4);while(u.getLengthInBits()%8!=0)u.putBit(!1);for(;;){if(u.getLengthInBits()>=l*8)break;u.put(n.PAD0,8);if(u.getLengthInBits()>=l*8)break;u.put(n.PAD1,8)}return n.createBytes(u,o)},n.createBytes=function(e,t){var n=0,i=0,s=0,o=new Array(t.length),u=new Array(t.length);for(var a=0;a<t.length;a++){var f=t[a].dataCount,l=t[a].totalCount-f;i=Math.max(i,f),s=Math.max(s,l),o[a]=new Array(f);for(var c=0;c<o[a].length;c++)o[a][c]=255&e.buffer[c+n];n+=f;var h=p.getErrorCorrectPolynomial(l),d=new r(o[a],h.getLength()-1),v=d.mod(h);u[a]=new Array(h.getLength()-1);for(var c=0;c<u[a].length;c++){var m=c+v.getLength()-u[a].length;u[a][c]=m>=0?v.get(m):0}}var g=0;for(var c=0;c<t.length;c++)g+=t[c].totalCount;var y=new Array(g),b=0;for(var c=0;c<i;c++)for(var a=0;a<t.length;a++)c<o[a].length&&(y[b++]=o[a][c]);for(var c=0;c<s;c++)for(var a=0;a<t.length;a++)c<u[a].length&&(y[b++]=u[a][c]);return y};var l={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},c={L:1,M:0,Q:3,H:2},h={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},p={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(e){var t=e<<10;while(p.getBCHDigit(t)-p.getBCHDigit(p.G15)>=0)t^=p.G15<<p.getBCHDigit(t)-p.getBCHDigit(p.G15);return(e<<10|t)^p.G15_MASK},getBCHTypeNumber:function(e){var t=e<<12;while(p.getBCHDigit(t)-p.getBCHDigit(p.G18)>=0)t^=p.G18<<p.getBCHDigit(t)-p.getBCHDigit(p.G18);return e<<12|t},getBCHDigit:function(e){var t=0;while(e!=0)t++,e>>>=1;return t},getPatternPosition:function(e){return p.PATTERN_POSITION_TABLE[e-1]},getMask:function(e,t,n){switch(e){case h.PATTERN000:return(t+n)%2==0;case h.PATTERN001:return t%2==0;case h.PATTERN010:return n%3==0;case h.PATTERN011:return(t+n)%3==0;case h.PATTERN100:return(Math.floor(t/2)+Math.floor(n/3))%2==0;case h.PATTERN101:return t*n%2+t*n%3==0;case h.PATTERN110:return(t*n%2+t*n%3)%2==0;case h.PATTERN111:return(t*n%3+(t+n)%2)%2==0;default:throw new Error("bad maskPattern:"+e)}},getErrorCorrectPolynomial:function(e){var t=new r([1],0);for(var n=0;n<e;n++)t=t.multiply(new r([1,d.gexp(n)],0));return t},getLengthInBits:function(e,t){if(1<=t&&t<10)switch(e){case l.MODE_NUMBER:return 10;case l.MODE_ALPHA_NUM:return 9;case l.MODE_8BIT_BYTE:return 8;case l.MODE_KANJI:return 8;default:throw new Error("mode:"+e)}else if(t<27)switch(e){case l.MODE_NUMBER:return 12;case l.MODE_ALPHA_NUM:return 11;case l.MODE_8BIT_BYTE:return 16;case l.MODE_KANJI:return 10;default:throw new Error("mode:"+e)}else{if(!(t<41))throw new Error("type:"+t);switch(e){case l.MODE_NUMBER:return 14;case l.MODE_ALPHA_NUM:return 13;case l.MODE_8BIT_BYTE:return 16;case l.MODE_KANJI:return 12;default:throw new Error("mode:"+e)}}},getLostPoint:function(e){var t=e.getModuleCount(),n=0;for(var r=0;r<t;r++)for(var i=0;i<t;i++){var s=0,o=e.isDark(r,i);for(var u=-1;u<=1;u++){if(r+u<0||t<=r+u)continue;for(var a=-1;a<=1;a++){if(i+a<0||t<=i+a)continue;if(u==0&&a==0)continue;o==e.isDark(r+u,i+a)&&s++}}s>5&&(n+=3+s-5)}for(var r=0;r<t-1;r++)for(var i=0;i<t-1;i++){var f=0;e.isDark(r,i)&&f++,e.isDark(r+1,i)&&f++,e.isDark(r,i+1)&&f++,e.isDark(r+1,i+1)&&f++;if(f==0||f==4)n+=3}for(var r=0;r<t;r++)for(var i=0;i<t-6;i++)e.isDark(r,i)&&!e.isDark(r,i+1)&&e.isDark(r,i+2)&&e.isDark(r,i+3)&&e.isDark(r,i+4)&&!e.isDark(r,i+5)&&e.isDark(r,i+6)&&(n+=40);for(var i=0;i<t;i++)for(var r=0;r<t-6;r++)e.isDark(r,i)&&!e.isDark(r+1,i)&&e.isDark(r+2,i)&&e.isDark(r+3,i)&&e.isDark(r+4,i)&&!e.isDark(r+5,i)&&e.isDark(r+6,i)&&(n+=40);var l=0;for(var i=0;i<t;i++)for(var r=0;r<t;r++)e.isDark(r,i)&&l++;var c=Math.abs(100*l/t/t-50)/5;return n+=c*10,n}},d={glog:function(e){if(e<1)throw new Error("glog("+e+")");return d.LOG_TABLE[e]},gexp:function(e){while(e<0)e+=255;while(e>=256)e-=255;return d.EXP_TABLE[e]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)};for(var v=0;v<8;v++)d.EXP_TABLE[v]=1<<v;for(var v=8;v<256;v++)d.EXP_TABLE[v]=d.EXP_TABLE[v-4]^d.EXP_TABLE[v-5]^d.EXP_TABLE[v-6]^d.EXP_TABLE[v-8];for(var v=0;v<255;v++)d.LOG_TABLE[d.EXP_TABLE[v]]=v;r.prototype={get:function(e){return this.num[e]},getLength:function(){return this.num.length},multiply:function(e){var t=new Array(this.getLength()+e.getLength()-1);for(var n=0;n<this.getLength();n++)for(var i=0;i<e.getLength();i++)t[n+i]^=d.gexp(d.glog(this.get(n))+d.glog(e.get(i)));return new r(t,0)},mod:function(e){if(this.getLength()-e.getLength()<0)return this;var t=d.glog(this.get(0))-d.glog(e.get(0)),n=new Array(this.getLength());for(var i=0;i<this.getLength();i++)n[i]=this.get(i);for(var i=0;i<e.getLength();i++)n[i]^=d.gexp(d.glog(e.get(i))+t);return(new r(n,0)).mod(e)}},i.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],i.getRSBlocks=function(e,t){var n=i.getRsBlockTable(e,t);if(n==undefined)throw new Error("bad rs block @ typeNumber:"+e+"/errorCorrectLevel:"+t);var r=n.length/3,s=[];for(var o=0;o<r;o++){var u=n[o*3+0],a=n[o*3+1],f=n[o*3+2];for(var l=0;l<u;l++)s.push(new i(a,f))}return s},i.getRsBlockTable=function(e,t){switch(t){case c.L:return i.RS_BLOCK_TABLE[(e-1)*4+0];case c.M:return i.RS_BLOCK_TABLE[(e-1)*4+1];case c.Q:return i.RS_BLOCK_TABLE[(e-1)*4+2];case c.H:return i.RS_BLOCK_TABLE[(e-1)*4+3];default:return undefined}},s.prototype={get:function(e){var t=Math.floor(e/8);return(this.buffer[t]>>>7-e%8&1)==1},put:function(e,t){for(var n=0;n<t;n++)this.putBit((e>>>t-n-1&1)==1)},getLengthInBits:function(){return this.length},putBit:function(e){var t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),e&&(this.buffer[t]|=128>>>this.length%8),this.length++}};var m=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],g=function(){var e=function(e,t){this._el=e,this._htOption=t};return e.prototype.draw=function(e){function t(e,t){var n=document.createElementNS("http://www.w3.org/2000/svg",e);for(var r in t)t.hasOwnProperty(r)&&n.setAttribute(r,t[r]);return n}var n=this._htOption,r=this._el,i=e.getModuleCount(),s=Math.floor(n.width/i),o=Math.floor(n.height/i);this.clear();var u=t("svg",{viewBox:"0 0 "+String(i)+" "+String(i),width:"100%",height:"100%",fill:n.colorLight});u.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),r.appendChild(u),u.appendChild(t("rect",{fill:n.colorLight,width:"100%",height:"100%"})),u.appendChild(t("rect",{fill:n.colorDark,width:"1",height:"1",id:"template"}));for(var a=0;a<i;a++)for(var f=0;f<i;f++)if(e.isDark(a,f)){var l=t("use",{x:String(f),y:String(a)});l.setAttributeNS("http://www.w3.org/1999/xlink","href","#template"),u.appendChild(l)}},e.prototype.clear=function(){while(this._el.hasChildNodes())this._el.removeChild(this._el.lastChild)},e}(),y=document.documentElement.tagName.toLowerCase()==="svg",b=y?g:o()?function(){function e(){this._elImage.src=this._elCanvas.toDataURL("image/png"),this._elImage.style.display="block",this._elCanvas.style.display="none"}function t(e,t){var n=this;n._fFail=t,n._fSuccess=e;if(n._bSupportDataURI===null){var r=document.createElement("img"),i=function(){n._bSupportDataURI=!1,n._fFail&&n._fFail.call(n)},s=function(){n._bSupportDataURI=!0,n._fSuccess&&n._fSuccess.call(n)};r.onabort=i,r.onerror=i,r.onload=s,r.src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==";return}n._bSupportDataURI===!0&&n._fSuccess?n._fSuccess.call(n):n._bSupportDataURI===!1&&n._fFail&&n._fFail.call(n)}if(this._android&&this._android<=2.1){var n=1/window.devicePixelRatio,r=CanvasRenderingContext2D.prototype.drawImage;CanvasRenderingContext2D.prototype.drawImage=function(e,t,i,s,o,u,a,f,l){if("nodeName"in e&&/img/i.test(e.nodeName))for(var c=arguments.length-1;c>=1;c--)arguments[c]=arguments[c]*n;else typeof f=="undefined"&&(arguments[1]*=n,arguments[2]*=n,arguments[3]*=n,arguments[4]*=n);r.apply(this,arguments)}}var i=function(e,t){this._bIsPainted=!1,this._android=u(),this._htOption=t,this._elCanvas=document.createElement("canvas"),this._elCanvas.width=t.width,this._elCanvas.height=t.height,e.appendChild(this._elCanvas),this._el=e,this._oContext=this._elCanvas.getContext("2d"),this._bIsPainted=!1,this._elImage=document.createElement("img"),this._elImage.alt="Scan me!",this._elImage.style.display="none",this._el.appendChild(this._elImage),this._bSupportDataURI=null};return i.prototype.draw=function(e){var t=this._elImage,n=this._oContext,r=this._htOption,i=e.getModuleCount(),s=r.width/i,o=r.height/i,u=Math.round(s),a=Math.round(o);t.style.display="none",this.clear();for(var f=0;f<i;f++)for(var l=0;l<i;l++){var c=e.isDark(f,l),h=l*s,p=f*o;n.strokeStyle=c?r.colorDark:r.colorLight,n.lineWidth=1,n.fillStyle=c?r.colorDark:r.colorLight,n.fillRect(h,p,s,o),n.strokeRect(Math.floor(h)+.5,Math.floor(p)+.5,u,a),n.strokeRect(Math.ceil(h)-.5,Math.ceil(p)-.5,u,a)}this._bIsPainted=!0},i.prototype.makeImage=function(){this._bIsPainted&&t.call(this,e)},i.prototype.isPainted=function(){return this._bIsPainted},i.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},i.prototype.round=function(e){return e?Math.floor(e*1e3)/1e3:e},i}():function(){var e=function(e,t){this._el=e,this._htOption=t};return e.prototype.draw=function(e){var t=this._htOption,n=this._el,r=e.getModuleCount(),i=Math.floor(t.width/r),s=Math.floor(t.height/r),o=['<table style="border:0;border-collapse:collapse;">'];for(var u=0;u<r;u++){o.push("<tr>");for(var a=0;a<r;a++)o.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+i+"px;height:"+s+"px;background-color:"+(e.isDark(u,a)?t.colorDark:t.colorLight)+';"></td>');o.push("</tr>")}o.push("</table>"),n.innerHTML=o.join("");var f=n.childNodes[0],l=(t.width-f.offsetWidth)/2,c=(t.height-f.offsetHeight)/2;l>0&&c>0&&(f.style.margin=c+"px "+l+"px")},e.prototype.clear=function(){this._el.innerHTML=""},e}();e=function(e,t){this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:c.H},typeof t=="string"&&(t={text:t});if(t)for(var n in t)this._htOption[n]=t[n];typeof e=="string"&&(e=document.getElementById(e)),this._htOption.useSVG&&(b=g),this._android=u(),this._el=e,this._oQRCode=null,this._oDrawing=new b(this._el,this._htOption),this._htOption.text&&this.makeCode(this._htOption.text)},e.prototype.makeCode=function(e){this._oQRCode=new n(a(e,this._htOption.correctLevel),this._htOption.correctLevel),this._oQRCode.addData(e),this._oQRCode.make(),this._el.title=e,this._oDrawing.draw(this._oQRCode),this.makeImage()},e.prototype.makeImage=function(){typeof this._oDrawing.makeImage=="function"&&(!this._android||this._android>=3)&&this._oDrawing.makeImage()},e.prototype.clear=function(){this._oDrawing.clear()},e.CorrectLevel=c}(),e}();ensureParamsAreValid=function(){function n(t){if(typeof t!="object")throw new TypeError("BitBtn params must be a object!");"label"in t||(t.label="Send");if(typeof t.label!="string")throw new TypeError("BitBtn Label must be a string!");"successMessage"in t||(t.successMessage="Done!");if(typeof t.successMessage!="string")throw new TypeError("BitBtn SuccessMessage must be a string!");"onPayment"in t||(t.onPayment=function(e){});if(typeof t.onPayment!="function")throw new TypeError("BitBtn onPayment must be a function!");"onError"in t||(t.onError=function(e){});if(typeof t.onError!="function")throw new TypeError("BitBtn onError must be a function!");i(t);if("outputs"in t){for(var n in e)if(e[n]in t)throw new Error("BitBtn with outputs cannot also have the following params: "+t.join(", "))}else{var r={};for(var n in e)e[n]in t&&(r[e[n]]=t[e[n]]);t.outputs=[r]}if(!Array.isArray(t.outputs))throw new TypeError("BitBtn outputs must be an array of objects!");for(var n in t.outputs){var o=t.outputs[n];if(typeof o!="object")throw new TypeError("BitBtn outputs must be an array of objects!");s(o)}}function i(e){"bip21"in e||(e.bip21=!0);if(typeof e.bip21!="boolean")throw new TypeError("BitBtn 'bip21' must be a boolean."
);if(e.bip21!==!0)throw new Error("BitBtn supports only BIP21 (for now). bip21 cannot be false.");if("outputs"in e)throw new Error("BitBtn supports only BIP21 (for now). Do not set the 'outputs' property");if("script"in e)throw new Error("BitBtn supports only BIP21 (for now). Do not set the 'script' property");if(!("amount"in e))throw new Error("BitBtn supports only BIP21 (for now). 'amount' property is required.");typeof e.amount=="string"&&(e.amount=parseFloat(e.amount));if(isNaN(e.amount)||e.amount<=0)throw new TypeError("BitBtn output amount must be a positive number!")}function s(e){"amount"in e||(e.amount=0),typeof e.amount=="string"&&(e.amount=parseFloat(e.amount));if(typeof e.amount!="number")throw new TypeError("BitBtn output amount must be a positive number or 0!");if(e.amount===NaN||e.amount<0)throw new TypeError("BitBtn output amount must be a positive number or 0!");"currency"in e||(e.currency="bsv");if(typeof e.currency!="string")throw new TypeError("BitBtn currency must be a string!");var t=r(e.currency);e.bsvAmount=e.amount/t,e.bsvAmount=Math.round(e.bsvAmount*1e8)/1e8;if(!("address"in e)&&"paymail"in e)throw new Error("BitBtn doesn't support paymail yet.");if("address"in e&&"script"in e)throw new Error("The same BitBtn output cannot have an address and a script at the same time.");if(!("address"in e||"script"in e))throw new Error("The same BitBtn output must have either an address or a script.");if("address"in e){if(typeof e.address!="string")throw new TypeError("BitBtn address must be a string.");if(!addrRegex.test(e.address))throw new Error("BitBtn address appears invalid: "+e.address);e.script=f.toAddress(e.address)}if(!("script"in e))throw new Error("BitBtn output doesn't have (or didn't generate) a script.");o(e)}function o(e){e.script=e.script.toUpperCase();var t=e.script.split(" ");for(var n=0;n<t.length;n++){var r=t[n].trim();if(r.replace(/\s/g,"").length<1)continue;if(opcodes.indexOf(r)>-1)continue;if(scriptData.test(r))continue;throw new SyntaxError("BitBtn - Invalid script syntax in '"+r+"' : "+e.script)}}var e=["address","amount","currency","script"];addrRegex=/[13][a-km-zA-HJ-NP-Z1-9]{25,34}/,scriptData=/(0x)?([0-9]|[A-F]|[a-f])+\b/,opcodes=["OP_FALSE","OP_1NEGATE","OP_TRUE","OP_NOP","OP_IF","OP_NOTIF","OP_ELSE","OP_ENDIF","OP_VERIFY","OP_RETURN","OP_EQUALVERIFY","OP_CHECKSIGVERIFY","OP_CHECKMULTISIGVERIFY","OP_IFDUP","OP_DEPTH","OP_DROP","OP_DUP","OP_NIP","OP_OVER","OP_PICK","OP_ROLL","OP_ROT","OP_SWAP","OP_TUCK","OP_2DROP","OP_2DUP","OP_3DUP","OP_2OVER","OP_2ROT","OP_2SWAP","OP_INVERT","OP_AND","OP_OR","OP_XOR","OP_EQUAL","OP_1ADD","OP_1SUB","OP_2MUL","OP_2DIV","OP_NEGATE","OP_ABS","OP_NOT","OP_0NOTEQUAL","OP_ADD","OP_SUB","OP_MUL","OP_DIV","OP_MOD","OP_LSHIFT","OP_RSHIFT","OP_BOOLAND","OP_BOOLOR","OP_NUMEQUAL","OP_NUMNOTEQUAL","OP_LESSTHAN","OP_GREATERTHAN","OP_LESSTHANOREQUAL","OP_GREATERTHANOREQUAL","OP_MIN","OP_MAX","OP_WITHIN","OP_RIPEMD160","OP_SHA1","OP_SHA256","OP_HASH160","OP_HASH256","OP_CHECKSIG","OP_CHECKMULTISIG"];for(var t=0;t<=16;t++)opcodes.push("OP_"+t);return n}();var f=function(){function r(e){return Array.from(e,function(e){return("0"+(e&255).toString(16)).slice(-2)}).join("")}function i(t){var i=n(t,e),s=i.slice(21),o=i.slice(1,21),u=r(o),a="OP_DUP OP_HASH160 "+u+" OP_EQUALVERIFY OP_CHECKSIG";return a}var e="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",t=function(e,t){var n=[],r="",i,s,o,u;for(i in e){s=0,o=e[i],r+=o||r.length^i?"":t[0];while(s in n||o)u=n[s],u=u?u*256+o:o,o=u/58|0,n[s]=u%58,s++}while(s--)r+=t[n[s]];return r},n=function(e,t){var n=[],r=[],i,s,o,u;for(i in e){s=0,o=t.indexOf(e[i]);if(o<0)return undefined;o||r.length^i?i:r.push(0);while(s in n||o)u=n[s],u=u?u*58+o:o,o=u>>8,n[s]=u%256,s++}while(s--)r.push(n[s]);return new Uint8Array(r)};return{toAddress:i}}();return{create:v,getPrice:r}}();